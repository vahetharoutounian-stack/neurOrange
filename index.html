# This packaged version of the Nickelodeon audio player removes the track emojis and the
# horizontal volume sliders that previously appeared when a track was playing.  The
# overall pill‚Äëshaped tray, bubble toggle, stop button and sprout buttons remain
# unchanged so the UI behaves exactly the same, but without the glyph swap or the
# intrusive volume bars.  This file is based off of the existing `index (2).html`
# provided in the repo and has been modified so that track buttons always display
# the sprout icon and volume sliders remain hidden at all times.
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="color-scheme" content="dark" />
<meta name="theme-color" content="#000000" />
<title>neurOrange ‚Äî Home (press orange to start)</title>

<style>
  :root{
    --bergamot:#FFA64D;       /* soft golden glow */
    --pure:#FFA500;
    --nick:#FF6600;           /* Nickelodeon */
    --after:#F9751F;          /* Afterimage */
    --gap-deg:3;
    --inner-thick:34px;       /* recomputed in JS */
    --outer-thick-mult:2.2;
    --emoji-font:18px;
    --glow:0 0 10px #000, 0 0 18px #000;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0; min-height:100%; background:#000; color:#fff;
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased; overflow:hidden;
  }

  /* === splash: press the orange to start === */
  #intro{
    position:fixed; inset:0; background:#000; display:grid; place-items:center;
    z-index:9999; opacity:1; pointer-events:auto; transition:opacity 900ms ease;
  }
  #intro.hidden{opacity:0; pointer-events:none}
  .intro-stack{display:grid; justify-items:center; gap:1rem}
  #startOrange{
    font-size:clamp(110px,30vw,240px); line-height:1; user-select:none; cursor:pointer;
    filter:drop-shadow(0 0 26px rgba(0,0,0,.65)) drop-shadow(0 0 50px rgba(255,165,0,.25));
    transition:transform .12s ease;
  }
  #startOrange:active{transform:scale(.98)}
  .intro-title{
    font-weight:900; letter-spacing:.14em; user-select:none;
    font-size:clamp(18px,6.2vw,44px);
    color:var(--bergamot);
    text-shadow:0 0 10px rgba(255,166,77,.55), 0 0 22px rgba(255,165,0,.35);
    animation:titlePulse 2.2s ease-in-out infinite;
  }
  @keyframes titlePulse{
    0%{color:var(--bergamot);text-shadow:0 0 10px rgba(255,166,77,.55),0 0 22px rgba(255,165,0,.35)}
    50%{color:var(--pure);    text-shadow:0 0 14px rgba(255,165,0,.65), 0 0 34px rgba(255,165,0,.45)}
    100%{color:var(--bergamot);text-shadow:0 0 10px rgba(255,166,77,.55),0 0 22px rgba(255,165,0,.35)}
  }

  /* === stage === */
  #phone{position:fixed; inset:0; display:grid; place-items:center}
  #canvas{position:relative; width:100%; height:100%; overflow:hidden; background:#000}

  #brandBar{position:absolute; left:0; right:0; top:10px; display:flex; justify-content:center; z-index:6; filter:drop-shadow(var(--glow))}
  #brand{font-weight:900; letter-spacing:.12em; font-size:clamp(18px,5vw,32px); color:#FFA500}

  /* background (video optional; fog always on) */
  #bgLayer{position:absolute; inset:0; z-index:1}
  #bgVideo{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .4s ease}
  .fogWrap{position:absolute; inset:-30%; z-index:0; pointer-events:none;
    -webkit-mask-image:radial-gradient(circle at 50% 50%, rgba(0,0,0,1) 62%, rgba(0,0,0,0) 100%);
            mask-image:radial-gradient(circle at 50% 50%, rgba(0,0,0,1) 62%, rgba(0,0,0,0) 100%);}
  .fog{position:absolute; inset:0; mix-blend-mode:screen; filter:blur(60px) saturate(120%);
       background:
         radial-gradient(28% 22% at 20% 30%, var(--nick) 0 55%, transparent 60%),
         radial-gradient(28% 24% at 80% 40%, var(--nick) 0 55%, transparent 60%),
         radial-gradient(30% 22% at 40% 70%, var(--nick) 0 55%, transparent 60%);
       animation:fog1 26s linear infinite alternate; opacity:.62}
  @keyframes fog1{0%{transform:translate(0,0) scale(1)}100%{transform:translate(-3%,-4%) scale(1.08)}}

  #focus{position:absolute; inset:0; display:grid; place-items:center; z-index:2}

  /* start shrunk & centered; grow on start */
  .wrapCenter{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(1); will-change:transform,opacity}
  .preGrow{transform:translate(-50%,-50%) scale(.05); opacity:0}
  .grow{animation:ringGrow var(--growDur,3600ms) cubic-bezier(.17,.9,.24,1.08) forwards; opacity:0}
  #innerWrap.grow {--growDur:3600ms; animation-delay:0ms}
  #midWrap.grow   {--growDur:4200ms; animation-delay:200ms}
  #outerWrap.grow {--growDur:4600ms; animation-delay:350ms}
  #emojiWrapA.grow{--growDur:4000ms; animation-delay:500ms}
  #emojiWrapB.grow{--growDur:4400ms; animation-delay:650ms}
  @keyframes ringGrow{
    0%   {transform:translate(-50%,-50%) scale(.05) rotate(0deg);   opacity:0}
    60%  {transform:translate(-50%,-50%) scale(1.10) rotate(45deg); opacity:1}
    100% {transform:translate(-50%,-50%) scale(1.00) rotate(0deg);  opacity:1}
  }

  .spin{position:absolute; inset:0}
  .halo{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); border-radius:50%;
        background:radial-gradient(closest-side, rgba(0,0,0,.35), rgba(0,0,0,0)); filter:blur(10px);
        pointer-events:none; z-index:-1}

  /* center prompt */
  #question{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(1);
    display:grid; place-items:center; background:#000; color:#fff; border-radius:50%; border:none;
    z-index:5; filter:drop-shadow(var(--glow)); padding:.4rem .6rem; user-select:none;
    animation:breathe 7s ease-in-out infinite;
  }
  @keyframes breathe{0%,100%{transform:translate(-50%,-50%) scale(1.00)}50%{transform:translate(-50%,-50%) scale(1.02)}}
  #questionText{
    font-weight:900; font-style:italic; text-align:center;
    font-size:clamp(16px,3.6vw,22px); line-height:1.15; margin:0;
    display:inline-block; transform-origin:50% 50%;
    animation:colorPulse 5.5s ease-in-out infinite;
  }
  @keyframes colorPulse{
    0%{color:#fff;text-shadow:0 0 6px rgba(255,255,255,.35)}
    33%{color:var(--bergamot);text-shadow:0 0 8px rgba(255,166,77,.45)}
    66%{color:#FFA500;text-shadow:0 0 8px rgba(255,165,0,.45)}
    100%{color:#fff;text-shadow:0 0 6px rgba(255,255,255,.35)}
  }

  /* continuous rotations */
  #innerSVG,#outerSVG{transform-box:fill-box; transform-origin:50% 50%; animation:spinCW 60s linear infinite}
  #outerSVG{animation-duration:70s}
  @keyframes spinCW{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

  /* emoji rings */
  #emojiWrapA,#emojiWrapB{z-index:4}
  .emojiRing{position:absolute; inset:0}
  .emojiSpin{position:absolute; inset:0; animation:spinCCW var(--dur,60s) linear infinite}
  @keyframes spinCCW{from{transform:rotate(0deg)}to{transform:rotate(-360deg)}}
  .emoji{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:var(--emoji-font);
         border:none; border-radius:10px; background:rgba(0,0,0,.08); padding:1px 3px;
         filter:drop-shadow(0 0 8px #000) drop-shadow(0 0 14px #000)}

  /* ghost flicker (outer ring) */
  .ghost-wedge{fill:var(--c0); animation:ghostFlick var(--dur,12s) ease-in-out infinite; animation-delay:var(--delay,0s); cursor:pointer}
  @keyframes ghostFlick{0%,88%,100%{fill:var(--c0)}89%,90%{fill:var(--c1)}}

  /* painting ring */
  #midWrap{z-index:8}
  #midSpin{animation:spinCCW 56s linear infinite; filter:drop-shadow(var(--glow))}
  #midRing{position:absolute; inset:0}
  .mnode{position:absolute; top:50%; left:50%; border-radius:50%; transform:translate(-50%,-50%);
         background:#111; overflow:hidden; border:1.5px solid #000; filter:drop-shadow(var(--glow));
         cursor:pointer}
  .mnode.withCloud::before{content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:calc(100% + 16px); height:calc(100% + 16px); border-radius:inherit;
    background:radial-gradient(closest-side, rgba(0,0,0,.38), rgba(0,0,0,0)); filter:blur(8px); pointer-events:none}
  .mnode img{width:100%; height:100%; object-fit:cover; display:block; border-radius:50%;
             animation:upright 56s linear infinite; transform-origin:center; backface-visibility:hidden}

  /* bottom nav */
  .bottomNav{
    position:fixed; left:0; right:0; bottom:calc(env(safe-area-inset-bottom) + 10px);
    z-index:8; display:flex; gap:10px; justify-content:space-between; padding:0 12px;
  }
  .navBtn{
    flex:1; text-align:center; font-weight:900; padding:10px 8px; border-radius:12px;
    border:1px solid rgba(0,0,0,.45); color:#140a00; user-select:none; -webkit-user-select:none; cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.35); text-decoration:none; display:inline-block;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    font-size:clamp(12px, 3.2vw, 14px); line-height:1.05;
  }
  .navLeft {background:linear-gradient(180deg,#F4C430,#E69B20)}
  .navMid  {background:linear-gradient(180deg,#FF8E00,#FF6A13)}
  .navRight{background:linear-gradient(180deg,#FFA500,#FE5000)}

  /* === TRANSITION OVERLAY (fade-to-black + randomized quote) === */
  #transition{
    position:fixed; inset:0; background:#000; z-index:10050;
    display:grid; place-items:center; opacity:0; pointer-events:none; transition:opacity 600ms ease;
  }
  #transition.show{opacity:1; pointer-events:auto}
  #quoteBox{max-width:min(92vw,720px); padding:2.2rem 1.6rem; text-align:center}
  #quoteText{
    font-weight:900; font-style:italic; letter-spacing:.02em;
    font-size:clamp(18px,5.2vw,30px); line-height:1.25; color:#ddd;
    text-shadow:0 0 10px rgba(0,0,0,.8);
  }
  .Oword{
    animation: orangeHue 2.8s ease-in-out infinite alternate, orangeGlow 2.8s ease-in-out infinite alternate;
  }
  @keyframes orangeHue{0%{color:var(--nick)}100%{color:var(--after)}}
  @keyframes orangeGlow{
    0%{ text-shadow:0 0 10px rgba(255,166,77,.55),0 0 18px rgba(255,102,0,.35) }
    100%{ text-shadow:0 0 12px rgba(255,166,77,.75),0 0 26px rgba(255,102,0,.55) }
  }
</style>
</head>
<body>

<!-- Intro -->
<div id="intro">
  <div class="intro-stack">
    <div id="startOrange" aria-label="Start">üçä</div>
    <div class="intro-title">neurOrange</div>
  </div>
</div>

<div id="phone">
  <div id="canvas">
    <div id="brandBar"><div id="brand">neurOrange</div></div>

    <div id="bgLayer">
      <video id="bgVideo" muted playsinline webkit-playsinline preload="auto" loop>
        <source src="assets/placeholder.mp4" type="video/mp4" />
      </video>
      <div class="fogWrap"><div class="fog"></div></div>
    </div>

    <div id="focus">
      <!-- Outer ring -->
      <div id="outerWrap" class="wrapCenter preGrow">
        <svg id="outerSVG" width="0" height="0" viewBox="0 0 1000 1000" style="position:absolute; inset:0"></svg>
        <div class="halo" id="outerHalo"></div>
      </div>

      <!-- Inner ring -->
      <div id="innerWrap" class="wrapCenter preGrow">
        <svg id="innerSVG" width="0" height="0" viewBox="0 0 1000 1000" style="position:absolute; inset:0"></svg>
        <div class="halo" id="innerHalo"></div>
      </div>

      <!-- Comets (optional visual layer) -->
      <div id="cometField" class="wrapCenter preGrow"></div>

      <!-- Painting ring -->
      <div id="midWrap" class="wrapCenter preGrow">
        <div id="midSpin" class="spin"><div id="midRing"></div></div>
      </div>

      <!-- (Optional) Emoji rings -->
      <div id="emojiWrapA" class="wrapCenter preGrow"><div class="emojiSpin" style="--dur:56s"><div id="emojiRingA" class="emojiRing"></div></div></div>
      <div id="emojiWrapB" class="wrapCenter preGrow"><div class="emojiSpin" style="--dur:82s; transform: rotate(-12deg)"><div id="emojiRingB" class="emojiRing"></div></div></div>

      <!-- Center prompt -->
      <div id="question"><div id="questionText">What are you<br/>feeling?</div></div>
    </div>

    <!-- Bottom nav -->
    <div class="bottomNav">
      <a class="navBtn navLeft"  href="https://vahetharoutounian-stack.github.io/neurOrangeV3/">Color Library</a>
      <a class="navBtn navMid"   href="https://vahetharoutounian-stack.github.io/neurOrangeV2/">Art Gallery</a>
      <a class="navBtn navRight" href="https://vahetharoutounian-stack.github.io/neurOrangeV3/#step=3">Illusion Lab</a>
    </div>
  </div>
</div>

<!-- Transition overlay -->
<div id="transition"><div id="quoteBox"><div id="quoteText"></div></div></div>

<script>
/* Targets */
const URLS = {
  color:  "https://vahetharoutounian-stack.github.io/neurOrangeV3/",
  gallery:"https://vahetharoutounian-stack.github.io/neurOrangeV2/"
};

/* EXACT six quotes (randomized each time, robust to Safari bfcache) */
const QUOTES_RAW = [
  "‚ÄúIt‚Äôs funny how the colors of the real world only seem really real when you viddy them on the screen.‚Äù ‚Äî A Clockwork Orange (1971)",
  "‚ÄúOrange is the happiest color.‚Äù ‚Äî Frank Sinatra",
  "‚ÄúThere is no blue without yellow and without orange.‚Äù ‚Äî Vincent Van Gogh",
  "‚ÄúThe orange tree took time to create this masterpiece.‚Äù ‚Äî Thich Nhat Hanh",
  "‚ÄúIf the real world is orange juice, then art is like orange juice concentrate.‚Äù ‚Äî Martin Mull",
  "‚ÄúIn a world full of yellows and reds, dare to be orange.‚Äù"
];
function decorateOrangeWords(str){ return str.replace(/orange/gi, m => `<span class="Oword">${m}</span>`); }
function randIndex(len){ try{ const a=new Uint32Array(1); crypto.getRandomValues(a); return a[0]%len; } catch { return Math.floor(Math.random()*len); } }
function pickQuoteHTML(){ return decorateOrangeWords(QUOTES_RAW[randIndex(QUOTES_RAW.length)]); }

/* Utilities */
function $(id){return document.getElementById(id)}
function $$(sel){return Array.from(document.querySelectorAll(sel))}
function hexNorm(h){return (h||'').replace(/^#/,'').toUpperCase()}

/* Center text rotation (1 rpm, bounded ¬±45¬∞) and sizing */
(function(){
  const t=$('questionText'); const b=$('question');
  const w=t.offsetWidth, h=t.offsetHeight, pad=Math.max(6,Math.round(Math.max(w,h)*0.20));
  const D=Math.ceil(Math.max(w,h)+pad*2); b.style.width=D+'px'; b.style.height=D+'px';
  let angle=0, dir=Math.random()<0.5?1:-1; const speed=360/60; let change=3+Math.random()*5; let last=performance.now();
  function step(now){
    const dt=(now-last)/1000; last=now; angle+=dir*speed*dt;
    if(angle>45){angle=45;dir=-1} if(angle<-45){angle=-45;dir=1}
    change-=dt; if(change<=0){ if(Math.random()<0.35) dir*=-1; change=3+Math.random()*5; }
    t.style.transform=`rotate(${angle.toFixed(3)}deg)`; requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
})();

/* Wedge helpers */
function wedgePath(cx,cy,r0,r1,a0Deg,a1Deg){
  const R=d=>d*Math.PI/180; const a0=R(a0Deg),a1=R(a1Deg);
  const P=(r,a)=>({x:cx+r*Math.cos(a),y:cy+r*Math.sin(a)}); const A=P(r1,a0),B=P(r1,a1),C=P(r0,a1),D=P(r0,a0);
  const large=(a1Deg-a0Deg)>180?1:0; return `M ${D.x} ${D.y} L ${A.x} ${A.y} A ${r1} ${r1} 0 ${large} 1 ${B.x} ${B.y} L ${C.x} ${C.y} A ${r0} ${r0} 0 ${large} 0 ${D.x} ${D.y} Z`;
}
function drawRing(svgEl,sizePx,r0px,r1px,colors,gapDeg, onClickHex){
  svgEl.setAttribute('viewBox','0 0 1000 1000'); svgEl.style.width=sizePx+'px'; svgEl.style.height=sizePx+'px';
  const k=1000/sizePx, r0=Math.max(2,r0px*k), r1=r1px*k, gap=Number(gapDeg)||0;
  const n=colors.length, slice=360/n; svgEl.innerHTML='';
  for(let i=0;i<n;i++){
    const hex=(typeof colors[i]==='string')? colors[i] : colors[i].hex;
    const a0=i*slice, a1=(i+1)*slice-gap;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',wedgePath(500,500,r0,r1,a0,a1));
    p.setAttribute('fill',hex);
    p.setAttribute('stroke','rgba(0,0,0,.18)'); p.setAttribute('stroke-width','1');
    if(onClickHex) p.addEventListener('click', ()=> onClickHex(hex), {passive:true});
    svgEl.appendChild(p);
  }
}
function drawGhostRing(svgEl,sizePx,r0px,r1px,ghostHexes,gapDeg){
  svgEl.setAttribute('viewBox','0 0 1000 1000'); svgEl.style.width=sizePx+'px'; svgEl.style.height=sizePx+'px';
  const k=1000/sizePx, r0=Math.max(2,r0px*k), r1=r1px*k, gap=Number(gapDeg)||0;
  const n=ghostHexes.length, slice=360/n; svgEl.innerHTML='';
  for(let i=0;i<n;i++){
    const base=ghostHexes[i]; const opp = opponent(base);
    const a0=i*slice, a1=(i+1)*slice-gap;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',wedgePath(500,500,r0,r1,a0,a1));
    p.classList.add('ghost-wedge');
    p.style.setProperty('--c0',base); p.style.setProperty('--c1',opp);
    const dur=10+Math.random()*6, phase=Math.random()*dur;
    p.style.setProperty('--dur',dur.toFixed(2)+'s'); p.style.setProperty('--delay',(-phase).toFixed(2)+'s'); /* start mid-cycle */
    p.setAttribute('stroke','rgba(0,0,0,.18)'); p.setAttribute('stroke-width','1');
    p.addEventListener('click', ()=> transitionTo(`${URLS.color}#step=3&cat=ghosts&hex=${base.replace('#','').toUpperCase()}`), {passive:true});
    svgEl.appendChild(p);
  }
}
function opponent(hex){
  hex=hex.replace('#',''); if(hex.length===3) hex=hex.split('').map(c=>c+c).join('');
  const r=parseInt(hex.slice(0,2),16), g=parseInt(hex.slice(2,4),16), b=parseInt(hex.slice(4,6),16);
  const {h,s,l}=rgbToHsl(r,g,b); const opp=(h+180)%360; const {r:R,g:G,b:B}=hslToRgb(opp,s,l);
  return '#'+[R,G,B].map(v=>v.toString(16).padStart(2,'0')).join('');
}
function rgbToHsl(r,g,b){r/=255;g/=255;b/=255;const mx=Math.max(r,g,b),mn=Math.min(r,g,b);let h,s,l=(mx+mn)/2;if(mx===mn){h=s=0}else{const d=mx-mn;s=l>0.5?d/(2-mx-mn):d/(mx+mn);switch(mx){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return {h:h*360,s,l}}
function hslToRgb(h,s,l){h/=360;let r,g,b;if(s===0){r=g=b=l}else{const hue2rgb=(p,q,t)=>{if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p};const q=l<0.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return {r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)}}

/* Layout rings + paintings + emojis */
const BRIGHT=[{hex:"#FE5000"},{hex:"#FFA500"},{hex:"#FF8E00"},{hex:"#FF6600"},{hex:"#FF6A00"},{hex:"#FF9400"},{hex:"#F28500"},{hex:"#FF7F24"},{hex:"#ED9121"},{hex:"#FFBF00"},{hex:"#FF5E00"},{hex:"#FF6A13"}];
const GHOSTS=["#B36019","#F9751F","#F6B76F","#D2B379","#E3AC47","#F88E10","#C18514","#DE9513","#92752D","#F0CE85","#FCBA45","#D99621","#E8C569","#F0B85F","#D2B265"];

function layoutRings(){
  const innerSVG=$('innerSVG'), outerSVG=$('outerSVG'), innerWrap=$('innerWrap'), outerWrap=$('outerWrap'), midRing=$('midRing');
  const W=innerWidth, H=innerHeight, S=Math.min(W,H);
  document.documentElement.style.setProperty('--emoji-font',Math.round(W*0.036)+'px');

  const innerD=Math.round(S*0.58), innerThick=Math.max(16,Math.round(innerD*0.12));
  innerWrap.style.width=innerD+'px'; innerWrap.style.height=innerD+'px';
  const innerOuter=innerD/2, innerInner=Math.max(2, innerOuter-innerThick*2);
  drawRing(innerSVG, innerD, innerInner, innerOuter, BRIGHT, getComputedStyle(document.documentElement).getPropertyValue('--gap-deg')||3,
    (hex)=>transitionTo(`https://vahetharoutounian-stack.github.io/neurOrangeV3/#step=2&cat=standards&hex=${hexNorm(hex)}`));

  /* paintings */
  const nodeD=Math.round(innerThick*0.85*5.25*0.82), margin=2, midR=Math.max(0, (W/2)-(nodeD/2)-margin);
  const N=6, step=2*Math.PI/N;
  if(!midRing.children.length){
    for(let i=1;i<=6;i++){
      const n=document.createElement('div'); n.className='mnode withCloud';
      n.addEventListener('click', ()=> transitionTo(`https://vahetharoutounian-stack.github.io/neurOrangeV2/#painting=${i}`), {passive:true});
      const img=new Image(); img.alt='Painting '+i; img.src=`assets/paintings/${i}.jpg`; n.appendChild(img);
      midRing.appendChild(n);
    }
  }
  Array.from(midRing.children).forEach((n,i)=>{const a=i*step, x=Math.cos(a)*midR, y=Math.sin(a)*midR;
    n.style.width=nodeD+'px'; n.style.height=nodeD+'px'; n.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;});

  /* ghost ring */
  const outerInnerR=midR + nodeD/2 + margin;
  const outerThick  = innerThick * (parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--outer-thick-mult'))||2.2);
  const outerOuterR = Math.max(outerInnerR + outerThick, W/2 + 8);
  const outD = Math.round(outerOuterR*2);
  outerWrap.style.width=outD+'px'; outerWrap.style.height=outD+'px';
  drawGhostRing(outerSVG, outD, outerInnerR, outerOuterR, GHOSTS, getComputedStyle(document.documentElement).getPropertyValue('--gap-deg')||3);

  /* emojis orbiting outside ghost ring (optional visual) */
  const gap=Math.max(8, Math.round(S*0.014));
  const rA=outerOuterR+gap, rB=rA+Math.max(22,Math.round(S*0.028));
  placeEmojis('emojiWrapA', rA, 0);
  placeEmojis('emojiWrapB', rB, (Math.PI*2)/(12*2));
}
function placeEmojis(wrapId,R,phase=0){
  const container=$(wrapId).querySelector('.emojiRing'); if(!container) return; container.innerHTML='';
  const EMOJIS=["&#128992;","&#129031;","&#128246;","&#128248;","&#129505;","&#127818;","&#129389;","&#129365;","&#127840;","&#127875;","&#127936;","&#128217;"];
  const n=12;
  for(let i=0;i<n;i++){
    const d=document.createElement('div'); d.className='emoji'; d.innerHTML=EMOJIS[i%EMOJIS.length];
    const a=i*(2*Math.PI/n)+phase, x=Math.cos(a)*R, y=Math.sin(a)*R;
    d.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
    container.appendChild(d);
  }
}

/* Transition with quote */
let transitioning=false;
function transitionTo(url){
  if(transitioning) return;
  transitioning=true;
  const tr=$('transition'), qt=$('quoteText');
  qt.innerHTML = pickQuoteHTML();
  tr.classList.add('show');
  setTimeout(()=>{ location.href=url; }, 2200);
}
function pickQuoteHTML(){
  try{ crypto.getRandomValues(new Uint32Array(1)); }catch{}
  const i = randIndex(QUOTES_RAW.length);
  return decorateOrangeWords(QUOTES_RAW[i]);
}
function randIndex(len){
  try{ const a=new Uint32Array(1); crypto.getRandomValues(a); return a[0]%len; }
  catch{ return Math.floor(Math.random()*len); }
}
function decorateOrangeWords(str){ return str.replace(/orange/gi, m=>`<span class="Oword">${m}</span>`); }

/* Start sequence on orange tap */
(function(){
  const orange=$('startOrange');
  orange.addEventListener('click', ()=>{
    const intro=$('intro'); intro.classList.add('hidden');
    setTimeout(()=>{
      intro.remove();

      /* play & reveal background video (safe on user gesture) */
      const v=$('bgVideo');
      if(v){
        const show=()=>v.style.opacity=1;
        v.addEventListener('loadeddata', show, {once:true});
        v.addEventListener('playing',    show, {once:true});
        const p=v.play(); if(p&&p.catch) p.catch(()=>{});
      }

      /* run grow-out */
      ['innerWrap','midWrap','outerWrap','emojiWrapA','emojiWrapB'].forEach(id=>{
        const el=$(id); if(!el) return;
        el.classList.remove('grow'); el.classList.add('preGrow');
        requestAnimationFrame(()=> el.classList.add('grow'));
      });
    }, 900); // match intro fade
  }, {passive:true});
})();

/* Rebuild layout initially (no grow until pressed) */
(function init(){ layoutRings(); })();

/* Re-randomize quote and reset overlay when coming back via Safari bfcache */
window.addEventListener('pageshow', ()=>{
  $('transition').classList.remove('show');
  transitioning=false;
  try{ crypto.getRandomValues(new Uint32Array(1)); }catch{}
});
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Nickelodeon Audio Player</title>
<style>
  :root {
    /* Nickelodeon orange palette for rim */
    --nick: #FF6600;
    --nick2: #FF3B00;
    /* Bergamot palette for toggle fill */
    --berg-a: #ffeca7;
    --berg-b: #ffd45c;
  }
  html, body { height: 100%; margin: 0; }
  body { background:#0f0f11; color:#fff; font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }

  /* Tray container anchored bottom-left. Same spacing collapsed or expanded. */
  #dock {
    position: fixed;
    left: calc(12px + env(safe-area-inset-left));
    bottom: calc(12px + env(safe-area-inset-bottom));
    z-index: 2147483647;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    border-radius: 999px;
    background: linear-gradient(135deg, var(--nick), var(--nick2));
    color: #fff;
    border: 1px solid rgba(0,0,0,0.35);
    box-shadow: 0 8px 20px rgba(255,102,0,0.32);
    -webkit-user-select: none;
    user-select: none;
  }
  /* When collapsed, hide all elements marked hideable. Do not adjust spacing to keep scale consistent */
  #dock.collapsed .hideable {
    display: none !important;
  }

  /* Nickelodeon bubble for the toggle button */
  .bubble {
    position: relative;
    width: 46px;
    height: 46px;
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 0;
    outline: none;
  }
  .bubble::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 999px;
    background: linear-gradient(135deg, var(--nick), var(--nick2));
    box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  }
  .bubble .inner {
    position: absolute;
    inset: 5px;
    border-radius: 999px;
    /* Bergamot radial fill */
    background: radial-gradient(60% 60% at 35% 25%, #fff6c2 0%, var(--berg-a) 40%, var(--berg-b) 100%);
  }
  .bubble .glyph {
    position: relative;
    z-index: 2;
    font-size: 22px;
    line-height: 46px;
    display: block;
    text-align: center;
  }

  /* Generic orb button for stop and tracks */
  .orb {
    width: 42px;
    height: 42px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    font-size: 20px;
    font-weight: 900;
    background: rgba(0,0,0,0.18);
    border: 1px solid rgba(0,0,0,0.35);
    cursor: pointer;
    position: relative;
    transition: opacity 0.18s ease, width 0.18s ease, margin 0.18s ease;
  }
  .badge {
    position: absolute;
    right: -6px;
    top: -6px;
    font-size: 12px;
    background: #111;
    border-radius: 6px;
    padding: 0 4px;
  }
  .glyph { pointer-events: none; }

  /* Sliders are hidden permanently in this version. */
  .nub {
    display: none !important;
    width: 96px;
    accent-color: #fff;
  }
  @media (min-width: 720px) {
    .nub {
      /* Sliders remain hidden */
    }
  }

  /* First-tap overlay used to unlock audio on iOS */
  #startOverlay {
    position: fixed;
    inset: 0;
    background: #000;
    opacity: 0.85;
    z-index: 2147483646;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #startOverlay button {
    background: linear-gradient(135deg, var(--nick), var(--nick2));
    border: 4px solid #fff;
    border-radius: 50%;
    width: 100px;
    height: 100px;
    font-size: 64px;
    line-height: 1;
    cursor: pointer;
  }
</style>
</head>
<body>

  <!-- Separate audio elements, one per track. Loops enabled. -->
  <audio id="a_sparkle" loop preload="metadata" playsinline>
    <source src="tracks/sparkle.mp3" type="audio/mpeg" />
    <source src="tracks/sparkle.m4a" type="audio/mp4" />
  </audio>
  <audio id="a_orange" loop preload="metadata" playsinline>
    <source src="tracks/orange.mp3" type="audio/mpeg" />
    <source src="tracks/orange.m4a" type="audio/mp4" />
  </audio>
  <audio id="a_autumn" loop preload="metadata" playsinline>
    <source src="tracks/autumn.mp3" type="audio/mpeg" />
    <source src="tracks/autumn.m4a" type="audio/mp4" />
  </audio>
  <audio id="a_storm" loop preload="metadata" playsinline>
    <source src="tracks/storm.mp3" type="audio/mpeg" />
    <source src="tracks/storm.m4a" type="audio/mp4" />
  </audio>
  <audio id="a_negin" loop preload="metadata" playsinline>
    <source src="tracks/negin.mp3" type="audio/mpeg" />
    <source src="tracks/negin.m4a" type="audio/mp4" />
  </audio>

  <!-- Overlay to require a user gesture before audio can play on some mobile browsers -->
  <div id="startOverlay"><button id="startBtn" aria-label="Start">üüß</button></div>

  <!-- Audio control tray. Initially collapsed; content hidden with CSS. -->
  <div id="dock" class="collapsed" role="group" aria-label="Audio controls">
    <!-- Toggle button: expands/collapses tray without affecting playback -->
    <button id="b_toggle" class="bubble" aria-label="Toggle">
      <span class="inner"></span><span class="glyph">üü°</span>
    </button>
    <!-- Stop button: stops all tracks and collapses tray -->
    <button id="b_stop" class="orb" aria-label="Stop / Reset">üüß</button>
    <!-- Track buttons (the sliders remain hidden) -->
    <!-- Sparkle -->
    <button id="b_sparkle" class="orb hideable" aria-label="Sparkle"><span class="glyph">üå±</span><span id="e_sparkle" class="badge"></span></button>
    <!-- Orange -->
    <button id="b_orangeTr" class="orb hideable" aria-label="Orange"><span class="glyph">üå±</span><span id="e_orange" class="badge"></span></button>
    <!-- Autumn -->
    <button id="b_autumn" class="orb hideable" aria-label="Autumn"><span class="glyph">üå±</span><span id="e_autumn" class="badge"></span></button>
    <!-- Storm -->
    <button id="b_storm" class="orb hideable" aria-label="Storm"><span class="glyph">üå±</span><span id="e_storm" class="badge"></span></button>
    <!-- Negin -->
    <button id="b_negin" class="orb hideable" aria-label="Negin"><span class="glyph">üå±</span><span id="e_negin" class="badge"></span></button>
  </div>

<script>
(() => {
  const dock    = document.getElementById('dock');
  const btnToggle = document.getElementById('b_toggle');
  const btnStop   = document.getElementById('b_stop');
  // Track definitions
  // Each track is exclusive except storm (concurrent) and has a seed button only; emojis are unused now.
  const tracks = [
    { id:'sparkle', emoji:'‚ú®', a:document.getElementById('a_sparkle'), b:document.getElementById('b_sparkle'), e:document.getElementById('e_sparkle'), exclusive:true },
    { id:'orange',  emoji:'üçä', a:document.getElementById('a_orange'),  b:document.getElementById('b_orangeTr'), e:document.getElementById('e_orange'),  exclusive:true },
    { id:'autumn',  emoji:'üçÇ', a:document.getElementById('a_autumn'),  b:document.getElementById('b_autumn'),  e:document.getElementById('e_autumn'),  exclusive:true },
    { id:'storm',   emoji:'‚õàÔ∏è', a:document.getElementById('a_storm'),   b:document.getElementById('b_storm'),   e:document.getElementById('e_storm'),   exclusive:false },
    { id:'negin',   emoji:'üí´', a:document.getElementById('a_negin'),   b:document.getElementById('b_negin'),   e:document.getElementById('e_negin'),   exclusive:true }
  ];
  // Loudness multipliers per track (optional; you can tweak these)
  const boosts = { sparkle:2.0, storm:3.0, orange:1.0, autumn:1.0, negin:1.0 };
  // Helpers
  // Reset the glyph on a button to the sprout; in this version we never swap to emoji.
  const seed = (btn) => { const g = btn.querySelector('.glyph'); if (g) g.textContent = 'üå±'; };
  // Show a badge on top of a button for warnings (e.g. missing audio)
  const badge = (el, msg) => { el.textContent = msg||''; if (msg) setTimeout(() => { el.textContent = ''; }, 1500); };
  // Apply volume boost (we keep audio volume fixed here since sliders are removed)
  const applyVolume = (t) => {
    const raw = 1.0;
    t.a.volume = Math.min(1, raw * (boosts[t.id] || 1));
  };
  // Initialize
  tracks.forEach(t => {
    seed(t.b);
    applyVolume(t);
  });
  function stop(t) {
    try { t.a.pause(); } catch (e) {}
    seed(t.b);
  }
  async function start(t) {
    if (t.exclusive) {
      tracks.forEach(x => { if (x !== t && x.exclusive && !x.a.paused) stop(x); });
    }
    try { t.a.currentTime = 0; } catch (e) {}
    seed(t.b);
    try {
      await t.a.play();
    } catch (err) {
      seed(t.b);
      badge(t.e,'‚ö†Ô∏è');
    }
  }
  // Wire events for each track
  tracks.forEach(t => {
    t.b.addEventListener('click', () => {
      if (t.a.paused) {
        start(t);
      } else {
        stop(t);
      }
    }, { passive: true });
    // No volume slider events because sliders are removed
    t.a.addEventListener('ended', () => { seed(t.b); });
    t.a.addEventListener('pause', () => {
      if (!t.a.ended) {
        seed(t.b);
      }
    });
  });
  // Toggle collapse/expand
  btnToggle.addEventListener('click', () => {
    dock.classList.toggle('collapsed');
  }, { passive: true });
  // Stop all and collapse
  btnStop.addEventListener('click', () => {
    tracks.forEach(stop);
    dock.classList.add('collapsed');
  }, { passive: true });
  // iOS audio unlock
  function unlockIOS() {
    if (unlockIOS.done) return;
    unlockIOS.done = true;
    const prev = tracks.map(t => ({ muted: t.a.muted, vol: t.a.volume }));
    tracks.forEach(t => { t.a.muted = true; t.a.volume = 0; });
    Promise.all(tracks.map(t => {
      try { t.a.play().catch(() => {}); } catch (e) {}
      return new Promise(resolve => setTimeout(resolve, 60));
    })).then(() => {
      tracks.forEach((t,i) => {
        try { t.a.pause(); } catch (e) {}
        t.a.currentTime = 0;
        t.a.muted = prev[i].muted;
        applyVolume(t);
      });
    });
  }
  window.addEventListener('pointerdown', unlockIOS, { once:true, passive:true });
  window.addEventListener('touchend',   unlockIOS, { once:true, passive:true });
  window.addEventListener('click',      unlockIOS, { once:true, passive:true });
  // First user gesture: hide overlay and auto start sparkle track
  const overlay = document.getElementById('startOverlay');
  overlay.addEventListener('click', () => {
    overlay.style.display = 'none';
    dock.classList.remove('collapsed');
    const sparkleTrack = tracks.find(x => x.id === 'sparkle');
    start(sparkleTrack);
  }, { once:true, passive:true });
})();
</script>
</body>
</html>
