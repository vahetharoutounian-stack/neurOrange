<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#000000">
<title>neurOrange ‚Äî Home (press-to-start, restored paintings, tight nav)</title>
<style>
  :root{
    --bergamot:#FFA64D; --pantone021:#FE5000; --pure:#FFA500; --nick:#FF6600;
    --gap-deg:3;
    --inner-thick:34px;
    --outer-thick-mult:2.2;
    --emoji-font:18px;
    --glow:0 0 10px #000, 0 0 18px #000;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;min-height:100%;background:#000;color:#fff;
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    -webkit-font-smoothing:antialiased;overflow:hidden
  }

  /* ===== BLACK FAILSAFE ===== */
  #failsafe{position:fixed;inset:0;background:#000;z-index:100000;opacity:1;transition:opacity .25s ease}

  /* ===== INTRO (press orange to start) ===== */
  #intro{
    position:fixed;inset:0;background:#000;display:grid;place-items:center;
    z-index:9999;opacity:1;pointer-events:auto;transition:opacity 900ms ease
  }
  #intro.hidden{opacity:0;pointer-events:none}
  .intro-stack{display:grid;justify-items:center;gap:1rem}
  #startOrange{
    font-size:clamp(110px,30vw,240px);line-height:1;
    filter:drop-shadow(0 0 26px rgba(0,0,0,.65)) drop-shadow(0 0 50px rgba(255,165,0,.25));
    user-select:none;cursor:pointer;transition:transform .12s ease
  }
  #startOrange:active{transform:scale(.98)}
  .intro-title{
    font-weight:900;letter-spacing:.14em;font-size:clamp(18px,6.2vw,44px);
    color:var(--bergamot);
    text-shadow:0 0 10px rgba(255,166,77,.55),0 0 22px rgba(255,165,0,.35);
    animation:titlePulse 2.2s ease-in-out infinite;user-select:none
  }
  @keyframes titlePulse{
    0%{color:var(--bergamot);text-shadow:0 0 10px rgba(255,166,77,.55),0 0 22px rgba(255,165,0,.35)}
    50%{color:var(--pure);text-shadow:0 0 14px rgba(255,165,0,.65),0 0 34px rgba(255,165,0,.45)}
    100%{color:var(--bergamot);text-shadow:0 0 10px rgba(255,166,77,.55),0 0 22px rgba(255,165,0,.35)}
  }

  /* ===== SCENE ===== */
  #phone{position:fixed;inset:0;display:grid;place-items:center}
  #canvas{position:relative;width:100%;height:100%;overflow:hidden;background:#000}
  #brandBar{position:absolute;left:0;right:0;top:10px;display:flex;justify-content:center;z-index:6;filter:drop-shadow(var(--glow))}
  #brand{font-weight:900;letter-spacing:.12em;font-size:clamp(18px,5vw,32px);color:#FFA500}

  #bgLayer{position:absolute;inset:0;z-index:1}
  #bgVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;background:#000;opacity:0;transition:opacity .4s ease}
  .fogWrap{position:absolute;inset:-30%;z-index:0;pointer-events:none;
    -webkit-mask-image:radial-gradient(circle at 50% 50%,rgba(0,0,0,1) 62%,rgba(0,0,0,0) 100%);
            mask-image:radial-gradient(circle at 50% 50%,rgba(0,0,0,1) 62%,rgba(0,0,0,0) 100%)}
  .fog{position:absolute;inset:0;mix-blend-mode:screen;filter:blur(60px) saturate(120%);
       background:
        radial-gradient(28% 22% at 20% 30%,var(--nick) 0 55%,transparent 60%),
        radial-gradient(28% 24% at 80% 40%,var(--nick) 0 55%,transparent 60%),
        radial-gradient(30% 22% at 40% 70%,var(--nick) 0 55%,transparent 60%);
       animation:fog1 26s linear infinite alternate;opacity:.62}
  @keyframes fog1{0%{transform:translate(0,0) scale(1)}100%{transform:translate(-3%,-4%) scale(1.08)}}

  #focus{position:absolute;inset:0;display:grid;place-items:center;z-index:2}

  /* Centered wrappers pre-shrunk (stay invisible until start) */
  .wrapCenter{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(1);will-change:transform,opacity}
  .preGrow{transform:translate(-50%,-50%) scale(.05);opacity:0}
  .grow{animation:ringGrow var(--growDur,3600ms) cubic-bezier(.17,.9,.24,1.08) forwards;opacity:0}
  #innerWrap.grow {--growDur:3600ms;animation-delay:0ms}
  #midWrap.grow   {--growDur:4200ms;animation-delay:200ms}
  #outerWrap.grow {--growDur:4600ms;animation-delay:350ms}
  #emojiWrapA.grow{--growDur:4000ms;animation-delay:500ms}
  #emojiWrapB.grow{--growDur:4400ms;animation-delay:650ms}
  @keyframes ringGrow{
    0%  {transform:translate(-50%,-50%) scale(.05) rotate(0deg);   opacity:0}
    60% {transform:translate(-50%,-50%) scale(1.10) rotate(45deg); opacity:1}
    100%{transform:translate(-50%,-50%) scale(1.00) rotate(0deg);  opacity:1}
  }

  .spin{position:absolute;inset:0}
  .halo{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:50%;background:radial-gradient(closest-side,rgba(0,0,0,.35),rgba(0,0,0,0));filter:blur(10px);pointer-events:none;z-index:-1}

  /* Center bubble (breath) */
  #question{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(1);
    display:grid;place-items:center;background:#000;color:#fff;border-radius:50%;border:none;
    z-index:5;filter:drop-shadow(var(--glow));padding:.4rem .6rem;user-select:none;
    animation:breathe 7s ease-in-out infinite
  }
  @keyframes breathe{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.02)}}
  #questionText{
    font-weight:900;font-style:italic;text-align:center;font-size:clamp(16px,3.6vw,22px);line-height:1.15;margin:0;
    display:inline-block;transform-origin:50% 50%;
    animation:colorPulse 5.5s ease-in-out infinite
  }
  @keyframes colorPulse{0%{color:#fff;text-shadow:0 0 6px rgba(255,255,255,.35)}33%{color:var(--bergamot);text-shadow:0 0 8px rgba(255,166,77,.45)}66%{color:var(--pure);text-shadow:0 0 8px rgba(255,165,0,.45)}100%{color:#fff;text-shadow:0 0 6px rgba(255,255,255,.35)}}

  /* Ring rotations (paused until start) */
  #innerSVG,#outerSVG{transform-box:fill-box;transform-origin:50% 50%;animation:spinCW 60s linear infinite;animation-play-state:paused}
  #outerSVG{animation-duration:70s}
  @keyframes spinCW{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
  .emojiSpin{position:absolute;inset:0;animation:spinCCW var(--dur,60s) linear infinite;animation-play-state:paused}
  @keyframes spinCCW{from{transform:rotate(0deg)}to{transform:rotate(-360deg)}}
  .emoji{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:var(--emoji-font);border:none;border-radius:10px;background:rgba(0,0,0,.08);padding:1px 3px;filter:drop-shadow(0 0 8px #000) drop-shadow(0 0 14px #000)}

  /* Ghost wedge flicker (paused until start) */
  .ghost-wedge{fill:var(--c0);animation:ghostFlick var(--dur,12s) ease-in-out infinite;animation-delay:var(--delay,0s);animation-play-state:paused}
  @keyframes ghostFlick{0%,88%,100%{fill:var(--c0)}89%,90%{fill:var(--c1)}}

  /* Paintings ring (mid) */
  #midWrap{z-index:8}
  #midSpin{animation:spinCCW 56s linear infinite;animation-play-state:paused;filter:drop-shadow(var(--glow))}
  #midRing{position:absolute;inset:0}
  .mnode{position:absolute;top:50%;left:50%;border-radius:50%;transform:translate(-50%,-50%);background:#111;overflow:hidden;border:1.5px solid #000;filter:drop-shadow(var(--glow))}
  .mnode.noimg{background:#191919}
  .mnode.withCloud::before{content:"";position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:calc(100% + 16px);height:calc(100% + 16px);border-radius:inherit;background:radial-gradient(closest-side,rgba(0,0,0,.38),rgba(0,0,0,0));filter:blur(8px);pointer-events:none}
  .mnode img{width:100%;height:100%;object-fit:cover;display:block;border-radius:50%;animation:upright 56s linear infinite;animation-play-state:paused;transform-origin:center;backface-visibility:hidden;will-change:transform}
  @keyframes upright{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

  /* Bottom navigation (tighter; one-line Color Library) */
  .bottomNav{
    position:fixed;left:0;right:0;bottom:calc(env(safe-area-inset-bottom) + 6px);
    z-index:8;display:flex;gap:8px;justify-content:space-between;padding:0 10px
  }
  .navBtn{
    flex:1;text-align:center;font-weight:900;padding:8px 8px;border-radius:12px;
    border:1px solid rgba(0,0,0,.45);color:#140a00;user-select:none;-webkit-user-select:none;cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.35);text-decoration:none;display:inline-block;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:clamp(11px,3vw,13px);line-height:1.05
  }
  .navLeft {background:linear-gradient(180deg,#F4C430,#E69B20)}   /* Color Library */
  .navMid  {background:linear-gradient(180deg,#FF8E00,#FF6A13)}   /* Art Gallery  */
  .navRight{background:linear-gradient(180deg,#FFA500,#FE5000)}   /* Illusion Lab */
</style>
</head>
<body>

<!-- Black failsafe -->
<div id="failsafe"></div>

<!-- Intro overlay (PRESS ORANGE TO START) -->
<div id="intro">
  <div class="intro-stack">
    <div id="startOrange" aria-label="Start">üçä</div>
    <div class="intro-title">neurOrange</div>
  </div>
</div>

<div id="phone">
  <div id="canvas">
    <div id="brandBar"><div id="brand">neurOrange</div></div>

    <div id="bgLayer">
      <video id="bgVideo" muted playsinline webkit-playsinline preload="auto"></video>
      <div class="fogWrap"><div class="fog"></div></div>
    </div>

    <div id="focus">
      <!-- Outer ring (SVG) -->
      <div id="outerWrap" class="wrapCenter preGrow">
        <svg id="outerSVG" width="0" height="0" viewBox="0 0 1000 1000" style="position:absolute;inset:0"></svg>
        <div class="halo" id="outerHalo"></div>
      </div>

      <!-- Inner ring (SVG) -->
      <div id="innerWrap" class="wrapCenter preGrow">
        <svg id="innerSVG" width="0" height="0" viewBox="0 0 1000 1000" style="position:absolute;inset:0"></svg>
        <div class="halo" id="innerHalo"></div>
      </div>

      <!-- Comet layer -->
      <div id="cometField" class="wrapCenter preGrow"></div>

      <!-- PAINTINGS RING (mid) -->
      <div id="midWrap" class="wrapCenter preGrow">
        <div id="midSpin" class="spin"><div id="midRing"></div></div>
      </div>

      <!-- Emoji rings -->
      <div id="emojiWrapA" class="wrapCenter preGrow"><div class="emojiSpin" style="--dur:56s"><div id="emojiRingA" class="emojiRing"></div></div></div>
      <div id="emojiWrapB" class="wrapCenter preGrow"><div class="emojiSpin" style="--dur:82s; transform: rotate(-12deg)"><div id="emojiRingB" class="emojiRing"></div></div></div>

      <!-- Center prompt -->
      <div id="question"><div id="questionText">What are you<br/>feeling?</div></div>
    </div>

    <!-- Bottom navigation (tight bubbles; one-line labels) -->
    <div class="bottomNav">
      <a class="navBtn navLeft"  href="color-library.html" aria-label="Color Library">Color Library</a>
      <a class="navBtn navMid"   href="art-gallery.html"   aria-label="Art Gallery">Art Gallery</a>
      <a class="navBtn navRight" href="illusion.html"      aria-label="Illusion Lab">Illusion Lab</a>
    </div>
  </div>
</div>

<script>
/* ===== Remove failsafe after first paint ===== */
(function killFailsafe(){
  const fs = document.getElementById('failsafe');
  requestAnimationFrame(()=>{ fs.style.opacity = 0; setTimeout(()=>fs.remove(), 300); });
})();

/* ===== Palettes ===== */
const BRIGHT=[
  {hex:"#FE5000"},{hex:"#FFA500"},{hex:"#FF8E00"},{hex:"#FF6600"},
  {hex:"#FF6A00"},{hex:"#FF9400"},{hex:"#F28500"},{hex:"#FF7F24"},
  {hex:"#ED9121"},{hex:"#FFBF00"},{hex:"#FF5E00"},{hex:"#FF6A13"}
];
const GHOSTS=[
  "#B36019","#F9751F","#F6B76F","#D2B379","#E3AC47",
  "#F88E10","#C18514","#DE9513","#92752D","#F0CE85",
  "#FCBA45","#D99621","#E8C569","#F0B85F","#D2B265"
];
const EMOJIS=["&#128992;","&#129031;","&#128246;","&#128248;","&#129505;","&#127818;","&#129389;","&#129365;","&#127840;","&#127875;","&#127936;","&#128217;"];

/* ===== Helpers ===== */
function $(id){return document.getElementById(id)}

function sizeQuestion(){
  const b=$('question'), t=$('questionText');
  b.style.transform='translate(-50%,-50%) scale(1)';
  const w=t.offsetWidth, h=t.offsetHeight, pad=Math.max(6,Math.round(Math.max(w,h)*0.20));
  const D=Math.ceil(Math.max(w,h)+pad*2);
  b.style.width=D+'px'; b.style.height=D+'px';
  startBoundedSpin();
}

/* color math */
function hexToRgb(h){h=h.replace('#',''); if(h.length===3){h=h.split('').map(c=>c+c).join('');}
  const n=parseInt(h,16); return {r:(n>>16)&255,g:(n>>8)&255,b:n&255};}
function rgbToHsl(r,g,b){r/=255;g/=255;b/=255;const max=Math.max(r,g,b),min=Math.min(r,g,b);
  let h,s,l=(max+min)/2; if(max===min){h=s=0;}else{const d=max-min; s=l>0.5?d/(2-max-min):d/(max+min);
  switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;} h/=6;}
  return {h:h*360,s:s,l:l};}
function hslToRgb(h,s,l){h/=360;let r,g,b;if(s===0){r=g=b=l;}else{
  const hue2rgb=(p,q,t)=>{if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;}
  const q=l<0.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}
  return {r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)};}
function rgbToHex(r,g,b){return '#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');}
function opponentHex(hex){const {r,g,b}=hexToRgb(hex);const {h,s,l}=rgbToHsl(r,g,b);const opp=(h+180)%360;const {r:rr,g:gg,b:bb}=hslToRgb(opp,s,l);return rgbToHex(rr,gg,bb);}

/* paths */
function wedgePath(cx,cy,r0,r1,a0Deg,a1Deg){
  const toRad=d=>d*Math.PI/180;const a0=toRad(a0Deg),a1=toRad(a1Deg);
  const P=(r,a)=>({x:cx+r*Math.cos(a),y:cy+r*Math.sin(a)});
  const A=P(r1,a0),B=P(r1,a1),C=P(r0,a1),D=P(r0,a0);const large=(a1Deg-a0Deg)>180?1:0;
  return `M ${D.x} ${D.y} L ${A.x} ${A.y} A ${r1} ${r1} 0 ${large} 1 ${B.x} ${B.y} L ${C.x} ${C.y} A ${r0} ${r0} 0 ${large} 0 ${D.x} ${D.y} Z`;
}

/* draw rings */
function drawRing(svgEl,sizePx,r0px,r1px,colors,gapDeg){
  svgEl.setAttribute('viewBox','0 0 1000 1000');
  svgEl.style.width=sizePx+'px';svgEl.style.height=sizePx+'px';
  const k=1000/sizePx,r0=Math.max(2,r0px*k),r1=r1px*k,g=Number(gapDeg)||0,n=colors.length,slice=360/n;
  svgEl.innerHTML='';
  for(let i=0;i<n;i++){
    const a0=i*slice,a1=(i+1)*slice-g;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',wedgePath(500,500,r0,r1,a0,a1));
    p.setAttribute('fill',colors[i]);
    p.setAttribute('stroke','rgba(0,0,0,.18)');
    p.setAttribute('stroke-width','1');
    svgEl.appendChild(p);
  }
}
function drawGhostRing(svgEl,sizePx,r0px,r1px,ghostHexes,gapDeg){
  svgEl.setAttribute('viewBox','0 0 1000 1000');
  svgEl.style.width=sizePx+'px';svgEl.style.height=sizePx+'px';
  const k=1000/sizePx,r0=Math.max(2,r0px*k),r1=r1px*k,g=Number(gapDeg)||0,n=ghostHexes.length,slice=360/n;
  svgEl.innerHTML='';
  for(let i=0;i<n;i++){
    const base=ghostHexes[i],opp=opponentHex(base),a0=i*slice,a1=(i+1)*slice-g;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',wedgePath(500,500,r0,r1,a0,a1));
    p.classList.add('ghost-wedge');
    p.style.setProperty('--c0',base);p.style.setProperty('--c1',opp);
    const dur=10+Math.random()*6,phase=Math.random()*dur;
    p.style.setProperty('--dur',dur.toFixed(2)+'s');
    p.style.setProperty('--delay',(-phase).toFixed(2)+'s'); /* start mid-cycle immediately */
    p.setAttribute('stroke','rgba(0,0,0,.18)');p.setAttribute('stroke-width','1');
    svgEl.appendChild(p);
  }
}

/* paintings ring */
function buildMidNodes(){
  const mid=$('midRing');mid.innerHTML='';
  for(let i=1;i<=6;i++){
    const n=document.createElement('div');n.className='mnode withCloud';
    const img=new Image();img.alt='Painting '+i;img.src=`assets/paintings/${i}.jpg`;
    img.onerror=()=>{n.classList.add('noimg')};n.appendChild(img);mid.appendChild(n);
  }
}

/* layout */
function layoutRings(){
  const innerSVG=$('innerSVG'),outerSVG=$('outerSVG'),innerWrap=$('innerWrap'),outerWrap=$('outerWrap'),midRing=$('midRing');
  const W=innerWidth,H=innerHeight,S=Math.min(W,H);
  document.documentElement.style.setProperty('--emoji-font',Math.round(W*0.036)+'px');
  const innerD=Math.round(S*0.58),innerThick=Math.max(16,Math.round(innerD*0.12));
  document.documentElement.style.setProperty('--inner-thick',innerThick+'px');
  innerWrap.style.width=innerD+'px';innerWrap.style.height=innerD+'px';
  const innerOuter=innerD/2,innerInner=Math.max(2,innerOuter-innerThick*2);
  drawRing(innerSVG,innerD,innerInner,innerOuter,BRIGHT.map(o=>o.hex),getComputedStyle(document.documentElement).getPropertyValue('--gap-deg')||3);

  const nodeD=Math.round(innerThick*0.85*5.25*0.82),margin=2,midR=Math.max(0,(W/2)-(nodeD/2)-margin);
  const nodes=$$('#midRing .mnode'); const N=6,step=2*Math.PI/N;
  nodes.forEach((n,i)=>{const a=i*step,x=Math.cos(a)*midR,y=Math.sin(a)*midR;n.style.width=nodeD+'px';n.style.height=nodeD+'px';n.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`});

  const outerInnerR=midR+nodeD/2+margin,outerThick=innerThick*(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--outer-thick-mult'))||2.2);
  const outerOuterR=Math.max(outerInnerR+outerThick,W/2+8),outD=Math.round(outerOuterR*2);
  outerWrap.style.width=outD+'px';outerWrap.style.height=outD+'px';
  drawGhostRing(outerSVG,outD,outerInnerR,outerOuterR,GHOSTS,getComputedStyle(document.documentElement).getPropertyValue('--gap-deg')||3);

  const gap=Math.max(8,Math.round(S*0.014)),rA=outerOuterR+gap,rB=rA+Math.max(22,Math.round(S*0.028));
  placeEmojis('emojiWrapA',rA,0);placeEmojis('emojiWrapB',rB,(Math.PI*2)/(12*2));
}
function $$(sel){return Array.from(document.querySelectorAll(sel))}
function placeEmojis(wrapId,R,phase=0){
  const container=$(wrapId).querySelector('.emojiRing');container.innerHTML='';
  const n=12;for(let i=0;i<n;i++){const d=document.createElement('div');d.className='emoji';d.innerHTML=EMOJIS[i%EMOJIS.length];
    const a=i*(2*Math.PI/n)+phase,x=Math.cos(a)*R,y=Math.sin(a)*R;d.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;container.appendChild(d);}
}

/* bounded 1 rpm center text */
let spinRAF,spinStarted=false;
function startBoundedSpin(){
  if(spinStarted) return; spinStarted=true;
  const t=$('questionText');let angle=0,dir=Math.random()<0.5?1:-1;const speed=360/60;
  let change=3+Math.random()*5,last=performance.now();
  function step(now){const dt=(now-last)/1000;last=now;angle+=dir*speed*dt;
    if(angle>45){angle=45;dir=-1} if(angle<-45){angle=-45;dir=1}
    change-=dt;if(change<=0){if(Math.random()<0.35)dir*=-1;change=3+Math.random()*5}
    t.style.transform=`rotate(${angle.toFixed(3)}deg)`;spinRAF=requestAnimationFrame(step)}
  spinRAF=requestAnimationFrame(step)
}

/* comet: cycle starts plain, then 4th=üå±, 5th=üåπ */
(function comet(){
  const field=$('cometField');const cycleLen=5;let cometCount=0;
  function spawn(){cometCount++;const idx=((cometCount-1)%cycleLen)+1;
    const W=innerWidth,H=innerHeight,run=Math.max(W,H)+400,theta=Math.random()*Math.PI*2;
    const kinds=['straight','offcenter','curved'];const kind=kinds[Math.floor(Math.random()*kinds.length)];
    const n={x:-Math.sin(theta),y:Math.cos(theta)},dur=4.8+Math.random()*3.0;let P0,P1,C;const center={x:0,y:0};
    if(kind==='straight'){P0={x:center.x-Math.cos(theta)*run/2,y:center.y-Math.sin(theta)*run/2};P1={x:center.x+Math.cos(theta)*run/2,y:center.y+Math.sin(theta)*run/2}}
    else if(kind==='offcenter'){const d=(Math.random()*0.35+0.15)*(W/2),sh={x:n.x*(Math.random()<0.5?-d:d),y:n.y*(Math.random()<0.5?-d:d)};
      P0={x:center.x-Math.cos(theta)*run/2+sh.x,y:center.y-Math.sin(theta)*run/2+sh.y};
      P1={x:center.x+Math.cos(theta)*run/2+sh.x,y:center.y-Math.sin(theta)*run/2+sh.y}}
    else{P0={x:center.x-Math.cos(theta)*run/2,y:center.y-Math.sin(theta)*run/2};P1={x:center.x+Math.cos(theta)*run/2,y:center.y-Math.sin(theta)*run/2};
      const bend=(Math.random()*0.5+0.3)*(W/2);C={x:center.x+n.x*(Math.random()<0.5?-bend:bend),y:center.y+n.y*(Math.random()<0.5?-bend:bend)}}
    const comet=document.createElement('div');comet.className='comet';const stk=document.createElement('div');stk.className='cometStack';
    const top=document.createElement('div');top.className='top';
    if(idx===1){top.innerHTML=''} else if(idx===5){top.innerHTML='üåπ'} else if(idx===4){top.innerHTML='üå±'} else {top.innerHTML='üü†'}
    const tail=document.createElement('div');tail.innerHTML='‚òÑÔ∏è';stk.appendChild(top);stk.appendChild(tail);comet.appendChild(stk);field.appendChild(comet);
    let t0=null;function lerp(a,b,t){return a+(b-a)*t}
    function draw(now){if(!t0)t0=now;const u=Math.min(1,(now-t0)/(dur*1000));let x,y;
      if(C){const one=1-u;x=one*one*P0.x+2*one*u*C.x+u*u*P1.x;y=one*one*P0.y+2*one*u*C.y+u*u*P1.y}
      else{x=lerp(P0.x,P1.x,u);y=lerp(P0.y,P1.y,u)}
      comet.style.transform=`translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      if(u<1)requestAnimationFrame(draw);else comet.remove()}
    requestAnimationFrame(draw)}
  (function loop(){spawn();setTimeout(loop,7000+Math.random()*5000)})()
})();

/* ===== Start only on ORANGE press ===== */
(function startOnOrange(){
  // prepare scene but keep everything pre-shrunk & paused
  buildMidNodes(); sizeQuestion(); layoutRings();

  const orange=$('startOrange');
  orange.addEventListener('click',()=>{
    const intro=$('intro');
    intro.classList.add('hidden');
    setTimeout(()=>{
      intro.remove();

      // reveal video when ready
      const v=$('bgVideo');
      if(v){
        v.addEventListener('playing',()=>v.style.opacity=1,{once:true});
        v.addEventListener('loadeddata',()=>v.style.opacity=1,{once:true});
        const p=v.play(); if(p&&p.catch) p.catch(()=>{});
      }

      // unpause rotations/flicker & run grow from center
      ['innerSVG','outerSVG'].forEach(id=>{const el=$(id); if(el) el.style.animationPlayState='running'});
      ['midSpin'].forEach(id=>{const el=$(id); if(el) el.style.animationPlayState='running'});
      $$('.mnode img').forEach(img=>img.style.animationPlayState='running');
      $$('.emojiSpin').forEach(es=>es.style.animationPlayState='running');
      $$('.ghost-wedge').forEach(g=>g.style.animationPlayState='running');

      // preGrow -> grow (ensures visible move-out with rotation)
      ['innerWrap','midWrap','outerWrap','emojiWrapA','emojiWrapB'].forEach(id=>{
        const el=$(id); if(!el) return;
        el.classList.remove('grow'); el.classList.add('preGrow');
        requestAnimationFrame(()=>{ el.classList.add('grow'); });
      });
    },900); // match intro fade
  },{passive:true});
})();
</script>
</body>
</html>
