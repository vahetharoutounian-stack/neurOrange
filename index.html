<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>neurOrange — Screen-locked Rings + Emoji Orbits (breathing question)</title>

<style>
  :root{
    /* iPhone-like aspect (we “lock” sizes by deriving everything from the canvas width in JS) */
    --iph-w:390; --iph-h:844;

    /* Brand & fog colors */
    --quin:#ED6A00;       /* Quinacridone Orange */
    --pure:#FFA500;       /* Pure Orange */
    --nick:#FF6600;       /* Nickelodeon Orange */
    --bergamot:#FFA64D;   /* Bergamot / Toranj */

    /* Inner ring geometry (initial; JS recalculates pixel sizes) */
    --ring-size: min(78vmin, 360px);   /* inner ring outer diameter */
    --ring-thick: clamp(18px, 7vmin, 34px);
    --gap-deg: 3deg;                   /* transparent separators */

    /* OUTER ring thicker than inner (applied outward via mask) */
    --outer-thick-mult: 2.3;

    /* Mid nodes */
    --mid-move-duration: 2200ms;

    /* Emoji ring font (JS sets to px from canvas width) */
    --emoji-font: 18px;
  }

  *{ box-sizing:border-box }
  html,body{
    margin:0; height:100%; background:#000; color:#fff;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    -webkit-font-smoothing: antialiased;
    overflow:hidden;
  }

  /* Phone canvas */
  #phone{ position:fixed; inset:0; display:grid; place-items:center; }
  #canvas{
    position:relative;
    width:min(100vw, calc(100vh*(var(--iph-w)/var(--iph-h))));
    aspect-ratio:var(--iph-w)/var(--iph-h);
    overflow:hidden;         /* phone borders crop content */
    background:#000;
  }

  /* ===== Z order: brand (6) → question (5) → emoji rings (4) → mid nodes (3) → inner (2.5) → outer (2) → background (1) ===== */

  /* Brand */
  #brandBar{
    position:absolute;
    top:max(12px, env(safe-area-inset-top));
    left:0; right:0;
    display:flex; justify-content:center;
    z-index:6;
    opacity:0; transform: translateY(-8px);
    transition: opacity 900ms ease, transform 900ms ease;
  }
  #brandBar.show{ opacity:1; transform: translateY(0); }
  #brand{
    font-weight:900;
    letter-spacing:.12em;
    font-size: clamp(20px, 5vw, 32px);
    animation: brandPulse 4s ease-in-out infinite;
  }
  @keyframes brandPulse{
    0%   { color:var(--quin); text-shadow:0 0 0 rgba(0,0,0,0) }
    50%  { color:var(--pure); text-shadow:0 0 16px rgba(255,165,0,.45) }
    100% { color:var(--quin); text-shadow:0 0 0 rgba(0,0,0,0) }
  }

  /* Background + fog */
  #bgLayer{ position:absolute; inset:0; z-index:1; opacity:0; transition:opacity 900ms ease; }
  #bgLayer.show{ opacity:1; }
  #bgVideo{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover; background:#000; pointer-events:none;
  }
  .fog{ position:absolute; inset:-25%; pointer-events:none; filter: blur(40px) saturate(120%); mix-blend-mode: screen; }
  .f1{ animation:fog1 22s linear infinite alternate; opacity:.7;
      background:
        radial-gradient(28% 22% at 20% 30%, #FF6600 0 55%, transparent 60%),
        radial-gradient(28% 24% at 80% 40%, #FF6600 0 55%, transparent 60%),
        radial-gradient(30% 22% at 40% 70%, #FF6600 0 55%, transparent 60%); }
  .f2{ animation:fog2 30s linear infinite alternate; opacity:.45;
      background:
        radial-gradient(26% 22% at 65% 20%, #FF6600 0 55%, transparent 60%),
        radial-gradient(28% 22% at 25% 75%, #FF6600 0 55%, transparent 60%),
        radial-gradient(24% 24% at 85% 80%, #FF6600 0 55%, transparent 60%); }
  .f3{ animation:fog3 36s linear infinite alternate; opacity:.35;
      background:
        radial-gradient(24% 20% at 10% 85%, #FF6600 0 55%, transparent 60%),
        radial-gradient(22% 22% at 90% 15%, #FF6600 0 55%, transparent 60%),
        radial-gradient(22% 22% at 55% 50%, #FF6600 0 55%, transparent 60%); }
  @keyframes fog1{ from{transform:translate(0,0)} to{transform:translate(-3%,-4%) scale(1.06)} }
  @keyframes fog2{ from{transform:translate(0,0)} to{transform:translate( 4%, 3%) scale(1.05)} }
  @keyframes fog3{ from{transform:translate(0,0)} to{transform:translate(-2%, 5%) scale(1.04)} }

  /* Focus stack root */
  #focus{ position:absolute; inset:0; display:grid; place-items:center; z-index:2; }

  /* Question bubble — smaller; tight margin; breathing + tint from Bergamot to Quinacridone */
  #question{
    position:absolute; left:50%; top:50%;
    transform: translate(-50%,-50%) scale(0.9);
    display:grid; place-items:center;
    background:#000; color:#fff; border-radius:50%;
    border:3px solid #000;         /* all borders black */
    opacity:0; transition: opacity 900ms ease, transform 900ms ease;
    z-index:5;
  }
  #questionText{
    font-weight:900; font-style:italic; text-align:center;
    font-size:clamp(15px, 3.4vw, 21px);  /* lock a bit smaller */
    line-height:1.15; margin:0;
    animation: tintPulse 3.4s ease-in-out infinite;
  }
  @keyframes tintPulse{
    0%   { color: var(--bergamot) }
    50%  { color: var(--quin) }
    100% { color: var(--bergamot) }
  }
  #question.show{ opacity:1; transform: translate(-50%,-50%) scale(1); }
  #question.rest{ transform: translate(-50%,-50%) scale(0.78); transition: transform 700ms ease; }
  #question.breathe{ animation: breathe 3.8s ease-in-out infinite; }
  @keyframes breathe{
    0%,100%{ transform: translate(-50%,-50%) scale(0.76) }
    50%    { transform: translate(-50%,-50%) scale(0.81) }
  }

  /* INNER ring (spins while popping, 1 rpm clockwise) */
  #ringScale{
    position:absolute;
    width:var(--ring-size); height:var(--ring-size);
    opacity:0; transform:scale(.975);
    transition: opacity 700ms ease, transform 700ms ease;
    z-index:2.5;
  }
  #ringScale.show{ opacity:1; transform:scale(1); }
  #ringSpin{ position:absolute; inset:0; animation: rotateCW 60s linear infinite; }
  @keyframes rotateCW { from{ transform: rotate(0deg) } to{ transform: rotate(360deg) } }

  #ring{
    position:absolute; inset:0; margin:auto;
    width:100%; height:100%; border-radius:50%;
    -webkit-mask: radial-gradient(circle,
      transparent calc(50% - var(--ring-thick)),
      #000       calc(50% - var(--ring-thick)),
      #000       calc(50% + var(--ring-thick)),
      transparent calc(50% + var(--ring-thick)));
    mask:radial-gradient(circle,
      transparent calc(50% - var(--ring-thick)),
      #000       calc(50% - var(--ring-thick)),
      #000       calc(50% + var(--ring-thick)),
      transparent calc(50% + var(--ring-thick)));
  }

  /* MID ring (spins CCW, nodes grow out slower, images upright) */
  #midSpin{ position:absolute; width:var(--ring-size); height:var(--ring-size); z-index:4; pointer-events:none; animation: rotateCCW 56s linear infinite; }
  @keyframes rotateCCW { from{ transform: rotate(0deg) } to{ transform: rotate(-360deg) } }

  #midRing{ position:absolute; inset:0; pointer-events:none; }
  .mnode{
    position:absolute; top:50%; left:50%;
    width:40px; height:40px;            /* JS sets final size */
    border-radius:50%;
    overflow:hidden; background:#111;
    border:3px solid #000;              /* BLACK */
    box-shadow:0 6px 18px rgba(0,0,0,.45);
    opacity:0;
    transform: translate(-50%,-50%) scale(.5);   /* half size at center */
    transition: transform var(--mid-move-duration) cubic-bezier(.22,.85,.2,1), opacity 450ms ease;
  }
  .mnode img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:50%; animation: fixSpin 56s linear infinite; }
  @keyframes fixSpin{ from{ transform: rotate(0deg) } to{ transform: rotate(360deg) } }
  .mnode.show{ opacity:1; transform: var(--final-transform, translate(-50%,-50%) scale(1)); }

  /* OUTER ring (thicker than inner; behind) */
  #outerScale{
    position:absolute;
    width:0; height:0;                   /* set in JS */
    opacity:0; transform:scale(.9);
    transition: opacity 800ms ease, transform 800ms ease;
    z-index:2;
  }
  #outerScale.show{ opacity:1; transform:scale(1); }
  #outerSpin{ position:absolute; inset:0; animation: rotateCW 70s linear infinite; }
  #outerRing{
    position:absolute; inset:0; margin:auto;
    width:100%; height:100%; border-radius:50%;
    /* mask set dynamically in JS to pixel radii */
  }

  /* TWO EMOJI RINGS outside outer — CCW spin, staggered; NO borders; only orange set */
  .emoScale{ position:absolute; width:0; height:0; opacity:0; transform:scale(.92); transition: opacity 800ms ease, transform 800ms ease; z-index:4; }
  .emoScale.show{ opacity:1; transform:scale(1); }
  .emoSpin{ position:absolute; inset:0; animation: rotateCCW var(--dur,60s) linear infinite; }
  .emoRing{ position:absolute; inset:0; }
  .emo{
    position:absolute; top:50%; left:50%;
    transform: translate(-50%,-50%);    /* positioned by JS with translate offsets */
    font-size: var(--emoji-font);
    line-height:1;
    /* no border / no box background any more */
    border:none; background:transparent; color:#fff;
  }
  /* keep emoji upright while parent spins */
  .emo > span{ display:inline-block; animation: fixSpin var(--dur,60s) linear infinite; }
</style>
</head>
<body>
  <div id="phone">
    <div id="canvas">

      <!-- Brand -->
      <div id="brandBar"><div id="brand">neurOrange</div></div>

      <!-- Background -->
      <div id="bgLayer">
        <video id="bgVideo" autoplay muted loop playsinline preload="auto">
          <source src="assets/placeholder.mp4" type="video/mp4" />
        </video>
        <div class="fog f1"></div><div class="fog f2"></div><div class="fog f3"></div>
      </div>

      <!-- Focus stack -->
      <div id="focus">

        <!-- OUTER ring (behind) -->
        <div id="outerScale">
          <div id="outerSpin"><div id="outerRing" aria-hidden="true"></div></div>
        </div>

        <!-- INNER ring -->
        <div id="ringScale">
          <div id="ringSpin"><div id="ring" aria-hidden="true"></div></div>
        </div>

        <!-- MID ring -->
        <div id="midSpin"><div id="midRing" aria-hidden="true"></div></div>

        <!-- EMOJI rings (outside outer; staggered CCW) -->
        <div id="emoScale1" class="emoScale"><div class="emoSpin" style="--dur:54s"><div id="emoRing1" class="emoRing"></div></div></div>
        <div id="emoScale2" class="emoScale"><div class="emoSpin" style="--dur:78s; transform: rotate(-10deg)"><div id="emoRing2" class="emoRing"></div></div></div>

        <!-- Question -->
        <div id="question"><div id="questionText">What are you<br/>feeling?</div></div>
      </div>

    </div>
  </div>

<script>
/* ================= ORANGE LIBRARY (ghosts + standards for reuse) ================= */
const ORANGE_LIBRARY = {
  ghosts: [
    { name:"Ghost Pepper Orange", hex:"#B36019" },
    { name:"Afterimage Orange", hex:"#F9751F" },
    { name:"CRT Ghost Orange", hex:"#F6B76F" },
    { name:"Will-o’-Wisp Orange", hex:"#D2B379" },
    { name:"Hitodama Orange", hex:"#E3AC47" },
    { name:"Jinn Flame Orange", hex:"#F88E10" },
    { name:"Phantom Orange", hex:"#C18514" },
    { name:"Specter Orange", hex:"#DE9513" },
    { name:"Wraith Orange", hex:"#92752D" },
    { name:"Apparition Orange", hex:"#F0CE85" },
    { name:"Clyde (Pac-Man Ghost)", hex:"#FCBA45" },
    { name:"Poltergeist Orange", hex:"#D99621" },
    { name:"Marfa Lights Orange", hex:"#E8C569" },
    { name:"Ghost Moth Orange", hex:"#F0B85F" },
    { name:"Hungry Ghost Orange", hex:"#D2B265" }
  ],
  standards: [
    { name:"Saffron Orange", hex:"#F4C430" },
    { name:"Amber", hex:"#FFBF00" },
    { name:"Marigold", hex:"#FCC200" },
    { name:"Tangerine", hex:"#F28500" },
    { name:"Sunset Orange", hex:"#FD5E53" },
    { name:"Flame", hex:"#E25822" },
    { name:"Pure Orange", hex:"#FFA500" },
    { name:"Persian Orange", hex:"#D99058" },
    { name:"Nārangī", hex:"#E87D0D" },
    { name:"Tiger Orange", hex:"#FF7F24" },
    { name:"Pumpkin Spice", hex:"#C76A1F" },
    { name:"Copper Orange", hex:"#CB6D51" },
    { name:"Coral Orange", hex:"#FF7F50" },
    { name:"Solar Orange", hex:"#FF8E00" },
    { name:"Desert Orange", hex:"#D07A2D" }
  ]
};
/* ================================================================================ */

/* Orange-only emoji set for the two emoji rings (no non-orange items) */
const EMOJIS = [
  "&#128992;","&#129031;","&#128246;","&#128248;","&#129505;", /* 🟠 🟧 🔶 🔸 🧡 */
  "&#127818;","&#129389;","&#129365;","&#127840;","&#127875;","&#127936;","&#128217;", /* 🍊 🥭 🥕 🍠 🎃 🏀 📙 */
  "&#129418;","&#128047;","&#128005;" /* 🦊 🐯 🐅 */
];

/* Ensure background video plays on iOS */
(function ensureVideoPlays(){
  const v = document.getElementById('bgVideo');
  function tryPlay(){ if (!v) return; const p=v.play(); if (p && p.catch) p.catch(()=>{}); }
  if (document.readyState !== 'loading') tryPlay();
  else window.addEventListener('DOMContentLoaded', tryPlay, {once:true});
  document.addEventListener('visibilitychange', ()=>{ if (!document.hidden && v && v.paused) tryPlay(); });
  window.addEventListener('touchstart', ()=>{ if (v && v.paused) tryPlay(); }, {passive:true});
})();

/* Helpers for conic painting with transparent gaps */
function getGapDeg(){
  const v = getComputedStyle(document.documentElement).getPropertyValue('--gap-deg');
  return parseFloat(v) || 3;
}
function conicFromTransparentGaps(colors, gapDeg){
  const seg = 360/colors.length;
  const parts=[];
  for(let i=0;i<colors.length;i++){
    const start=i*seg;
    const colorEnd = start + (seg - gapDeg);
    const gapEnd   = start + seg;
    parts.push(`${colors[i]} ${start}deg ${colorEnd}deg`, `transparent ${colorEnd}deg ${gapEnd}deg`);
  }
  return `conic-gradient(${parts.join(',')})`;
}

/* Paint inner/outer rings ghost-first (fill rest with standards) */
(function paintRings(){
  const ghosts = ORANGE_LIBRARY.ghosts.map(g=>g.hex);
  const std    = ORANGE_LIBRARY.standards.map(s=>s.hex);
  function palette(n){
    const out = ghosts.slice(0, n);
    let i=0; while(out.length<n){ out.push(std[i++ % std.length]); }
    return out;
  }
  const innerRing = document.getElementById('ring');
  innerRing.style.background = conicFromTransparentGaps(palette(12), getGapDeg());
  const outerRing = document.getElementById('outerRing');
  outerRing.style.background = conicFromTransparentGaps(palette(18), getGapDeg());
})();

/* Utility: resolve CSS var to px by probing */
function resolveCssPx(varName, ctx){
  const probe = document.createElement('div');
  probe.style.position='absolute';
  probe.style.width = `var(${varName})`;
  probe.style.height='0';
  probe.style.visibility='hidden';
  (ctx||document.body).appendChild(probe);
  const w = probe.getBoundingClientRect().width;
  probe.remove();
  return w;
}

/* Tight question bubble sizing */
function sizeQuestionBubble(){
  const bubble = document.getElementById('question');
  const txt = document.getElementById('questionText');
  const prev = bubble.style.transform;
  bubble.style.transform = 'translate(-50%,-50%) scale(1)';

  const w = txt.offsetWidth;
  const h = txt.offsetHeight;
  const pad = Math.max(4, Math.round(Math.max(w,h) * 0.02));  // 2% margin
  const D = Math.ceil(Math.max(w,h) + pad*2);

  bubble.style.width  = D+'px';
  bubble.style.height = D+'px';
  bubble.style.transform = prev || 'translate(-50%,-50%) scale(0.9)';
}

/* Build mid nodes (images) at center; targets set in layoutGeometry */
function prebuildMidNodes(){
  const mid  = document.getElementById('midRing');
  mid.innerHTML='';
  const PAINTS = [
    'assets/paintings/1.jpg','assets/paintings/2.jpg','assets/paintings/3.jpg',
    'assets/paintings/4.jpg','assets/paintings/5.jpg','assets/paintings/6.jpg'
  ];
  for(let i=0;i<6;i++){
    const n = document.createElement('div'); n.className='mnode';
    const img = new Image();
    img.src = PAINTS[i % PAINTS.length]; img.alt='Painting'; img.onerror=()=>img.remove();
    n.appendChild(img); mid.appendChild(n);
  }
}

/* Build emoji rings content (orange-only) */
function prebuildEmojiRings(){
  const r1 = document.getElementById('emoRing1');
  const r2 = document.getElementById('emoRing2');
  r1.innerHTML = ''; r2.innerHTML = '';

  // split emojis into two lists to balance
  const e1=[], e2=[];
  EMOJIS.forEach((e,i)=> (i%2? e2:e1).push(e));

  function fill(target, list, count){
    for(let i=0;i<count;i++){
      const node = document.createElement('div');
      node.className='emo';
      node.innerHTML = `<span>${list[i % list.length]}</span>`;
      target.appendChild(node);
    }
  }
  fill(r1, e1, 18);
  fill(r2, e2, 20);
}

/* Geometry locking — sizes derived from canvas width so they stay consistent on iPhone Safari */
function layoutGeometry(){
  const root    = document.documentElement;
  const canvas  = document.getElementById('canvas');
  const ringWrap= document.getElementById('ringScale');
  const midRing = document.getElementById('midRing');
  const outScale= document.getElementById('outerScale');
  const outRing = document.getElementById('outerRing');
  const emoScale1 = document.getElementById('emoScale1');
  const emoScale2 = document.getElementById('emoScale2');
  const emoRing1  = document.getElementById('emoRing1');
  const emoRing2  = document.getElementById('emoRing2');

  const canvasW = canvas.getBoundingClientRect().width;

  /* lock font size for emoji relative to canvas width */
  root.style.setProperty('--emoji-font', Math.round(canvasW*0.036)+'px');

  /* mid nodes hit the phone sides */
  const innerThickPx = resolveCssPx('--ring-thick', ringWrap);
  const baseNodeD    = Math.max(20, Math.round(innerThickPx * 0.85));
  const nodeD        = Math.round(baseNodeD * 5.25);
  const margin = 2;
  const midRadius = Math.max(0, (canvasW/2) - (nodeD/2) - margin);

  const nodes = midRing.querySelectorAll('.mnode');
  const N=6, stepRad = (Math.PI*2)/N;
  nodes.forEach((n,i)=>{
    const a=i*stepRad;
    const x=Math.cos(a)*midRadius;
    const y=Math.sin(a)*midRadius;
    n.style.width=n.style.height=nodeD+'px';
    n.style.setProperty('--final-transform', `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) scale(1)`);
  });

  /* outer ring thickness & size (thicker than inner) */
  const outerInnerR = midRadius + nodeD/2 + margin;
  const mult = parseFloat(getComputedStyle(root).getPropertyValue('--outer-thick-mult')) || 2.3;
  const desiredOuterR = outerInnerR + innerThickPx * mult;
  const overshoot = 8;
  const minOuterR = canvasW/2 + overshoot;
  const outerOuterR = Math.max(desiredOuterR, minOuterR);
  const outD = Math.max(outerOuterR*2, 0);
  outScale.style.width  = outD+'px';
  outScale.style.height = outD+'px';

  const maskStr = `radial-gradient(circle,
      transparent ${outerInnerR}px,
      #000       ${outerInnerR}px,
      #000       ${outerOuterR}px,
      transparent ${outerOuterR}px)`;
  outRing.style.webkitMask = maskStr;
  outRing.style.mask = maskStr;

  /* emoji rings radii (constant gap from the outer ring) */
  const emojiGap = 14;
  const emojiR1  = outerOuterR + emojiGap;
  const emojiR2  = emojiR1 + 28;       // stagger

  emoScale1.style.width = emoScale1.style.height = (emojiR1*2)+'px';
  emoScale2.style.width = emoScale2.style.height = (emojiR2*2)+'px';

  function placeEmoji(ringEl, radius){
    const items = ringEl.querySelectorAll('.emo');
    const count = items.length;
    const step  = (Math.PI*2)/count;
    items.forEach((el,i)=>{
      const a = i*step;
      const x = Math.cos(a)*radius;
      const y = Math.sin(a)*radius;
      el.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
    });
  }
  placeEmoji(emoRing1, emojiR1);
  placeEmoji(emoRing2, emojiR2);
}

/* Build inner/outer palettes */
(function paintRings(){
  const ghosts = ORANGE_LIBRARY.ghosts.map(g=>g.hex);
  const std    = ORANGE_LIBRARY.standards.map(s=>s.hex);
  function palette(n){
    const out = ghosts.slice(0, n);
    let i=0; while(out.length<n){ out.push(std[i++ % std.length]); }
    return out;
  }
  const innerRing = document.getElementById('ring');
  innerRing.style.background = conicFromTransparentGaps(palette(12), getGapDeg());
  const outerRing = document.getElementById('outerRing');
  outerRing.style.background = conicFromTransparentGaps(palette(18), getGapDeg());
})();

/* Sequence */
(function sequence(){
  const brandBar   = document.getElementById('brandBar');
  const bgLayer    = document.getElementById('bgLayer');
  const question   = document.getElementById('question');
  const ringScale  = document.getElementById('ringScale');
  const midRing    = document.getElementById('midRing');
  const outerScale = document.getElementById('outerScale');
  const emoScale1  = document.getElementById('emoScale1');
  const emoScale2  = document.getElementById('emoScale2');

  /* initial measurements (locks scale across Safari on iPhone) */
  sizeQuestionBubble();
  prebuildMidNodes();
  prebuildEmojiRings();
  layoutGeometry();
  window.addEventListener('resize', ()=>{
    sizeQuestionBubble();
    layoutGeometry();
  });

  // Brand → background → question
  setTimeout(()=> brandBar.classList.add('show'), 100);
  setTimeout(()=> bgLayer.classList.add('show'), 1100);
  setTimeout(()=>{
    question.classList.add('show');
    setTimeout(sizeQuestionBubble, 120);
  }, 2100);

  // Question rests + starts breathing + tint already pulsing
  const tQRest = 3000;
  setTimeout(()=> {
    question.classList.add('rest');
    question.classList.add('breathe');
  }, tQRest);

  // Inner ring grows 0.5s after rest
  const tInnerStart = tQRest + 500;
  setTimeout(()=> ringScale.classList.add('show'), tInnerStart);

  // Mid nodes grow 0.75s after inner begins (spin CCW already)
  const tMidStart = tInnerStart + 750;
  setTimeout(()=>{
    const nodes = midRing.querySelectorAll('.mnode');
    nodes.forEach((n,i)=> setTimeout(()=> n.classList.add('show'), i*140));
  }, tMidStart);

  // Outer ring grows; emoji rings appear (staggered)
  setTimeout(()=> {
    outerScale.classList.add('show');
    emoScale1.classList.add('show');
    setTimeout(()=> emoScale2.classList.add('show'), 200);
  }, tMidStart + 400);
})();
</script>
</body>
</html>
